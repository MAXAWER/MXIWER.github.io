<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MThread - Лента объявлений</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <header class="site-header">
        <div class="button-container">
            <a href="https://t.me/Sureddorippaa" target="_blank" class="button">MThread Маркет</a>
            <a href="https://t.me/SureddorippaaChat" target="_blank" class="button">MThread Чат</a>
            <a href="https://t.me/SureddorippaaReviews" target="_blank" class="button">MThread Отзывы</a>
        </div>
    </header>

    <main class="feed-container">
        <h2 class="feed-title">Лента объявлений</h2>

        <div class="horizontal-feed">
            <button class="nav-button prev-button" aria-label="Предыдущее объявление">&lt;</button>

            <div class="announcements-wrapper">

                <article class="announcement-card">
                    <img src="1.png" alt="Фото Контроллер Nintendo Switch" class="announcement-photo" loading="lazy">
                    <div class="announcement-content">
                        <div class="price-buy-block">
                            <div class="location-price">
                                <p><strong>Город:</strong> Астана.</p>
                                <p class="announcement-price">Цена: 10 000 тенге</p>
                            </div>
                            <a href="https://t.me/mxiwer" target="_blank" rel="noopener noreferrer" class="buy-button">Купить</a>
                        </div>
                        <h3 class="announcement-title">Контроллер для игровой консоли Nintendo Switch</h3>
                        <p><strong>Состояние:</strong> Полностью исправен, функциональных дефектов не имеет. Подтверждена работоспособность всех кнопок и функций.</p>
                        <p><strong>Цвет:</strong> Черный.</p>
                        <p><strong>Комплект поставки:</strong> Только контроллер (без оригинальной упаковки, кабелей и дополнительных аксессуаров).</p>
                    </div>
                </article>

                <article class="announcement-card">
                     <img src="3.png" alt="Фото Салазки для HDD Nzxt H710I" class="announcement-photo" loading="lazy">
                    <div class="announcement-content">
                        <div class="price-buy-block">
                            <div class="location-price">
                                <p><strong>Город:</strong> Астана.</p>
                                <p class="announcement-price">Цена: 5 000 тенге</p>
                            </div>
                            <a href="https://t.me/mxiwer" target="_blank" rel="noopener noreferrer" class="buy-button">Купить</a>
                        </div>
                        <h3 class="announcement-title">Салазки для HDD из корпуса Nzxt H710I</h3>
                        <p><strong>Состояние:</strong> Хорошее.</p>
                        <p><strong>Цвет:</strong> Черный.</p>
                        <p><strong>Комплект поставки:</strong> Без комплекта (только салазки).</p>
                    </div>
                </article>

                <article class="announcement-card">
                     <img src="4.png" alt="Фото Ноутбук Dell Alienware 17 R2" class="announcement-photo" loading="lazy">
                    <div class="announcement-content">
                         <div class="price-buy-block">
                             <div class="location-price">
                                <p><strong>Город:</strong> Астана.</p>
                                <p class="announcement-price">Цена: 120 000 тенге</p>
                             </div>
                            <a href="https://t.me/mxiwer" target="_blank" rel="noopener noreferrer" class="buy-button">Купить</a>
                        </div>
                        <h3 class="announcement-title">Ноутбук Dell Alienware 17 R2</h3>
                        <p><strong>Состояние:</strong> Полностью рабочий, установлен новый аккумулятор, несколько царапин на крышке (визуальный недостаток, не влияющий на основную функциональность).</p>
                        <p><strong>Цвет:</strong> Черно-серый.</p>
                        <p><strong>Комплект поставки:</strong> Зарядное устройство и коробка.</p>
                        <div class="announcement-specs">
                            <strong>Характеристики:</strong>
                            <ul>
                                <li>Процессор: Intel Core i7-4710HQ</li>
                                <li>Оперативная память: 16 ГБ DDR3</li>
                                <li>Видеокарта: NVIDIA GeForce GTX 980</li>
                                <li>Накопитель: SSD M.2 128 ГБ</li>
                            </ul>
                        </div>
                    </div>
                </article>

                <article class="announcement-card">
                    <img src="5.png" alt="Фото Alienware Graphics Amplifier (eGPU)" class="announcement-photo" loading="lazy">
                    <div class="announcement-content">
                         <div class="price-buy-block">
                             <div class="location-price">
                                <p><strong>Город:</strong> Астана.</p>
                                <p class="announcement-price">Цена: 50 000 тенге</p>
                             </div>
                            <a href="https://t.me/mxiwer" target="_blank" rel="noopener noreferrer" class="buy-button">Купить</a>
                        </div>
                        <h3 class="announcement-title">Alienware Graphics Amplifier (eGPU)</h3>
                        <p><strong>Состояние:</strong> В хорошем состоянии, полностью рабочий.</p>
                        <p><strong>Цвет:</strong> Черный.</p>
                        <p><strong>Комплект поставки:</strong> Кабель соединения с ПК, кабель питания.</p>
                        <div class="announcement-description">
                            <strong>Описание:</strong>
                            <p>Alienware Graphics Amplifier представляет собой внешнюю док-станцию для видеокарты, разработанную специально для ноутбуков Alienware. Это устройство позволяет значительно повысить графическую производительность ноутбука, подключая к нему настольную видеокарту. Amplifier оснащен собственным блоком питания, обеспечивающим необходимую мощность для работы высокопроизводительных видеокарт. Подключение к ноутбуку осуществляется через проприетарный разъем PCI-Express, обеспечивающий высокую пропускную способность для передачи данных между видеокартой и системой ноутбука. Использование Graphics Amplifier позволяет запускать на ноутбуке самые требовательные игры и приложения, требующие мощной графики, при этом сохраняя мобильность самого ноутбука при необходимости.</p> </div>
                    </div>
                </article>

                <article class="announcement-card">
                    <img src="6.png" alt="Фото iPhone 4s 8Gb" class="announcement-photo" loading="lazy">
                    <div class="announcement-content">
                         <div class="price-buy-block">
                             <div class="location-price">
                                <p><strong>Город:</strong> Астана.</p>
                                <p class="announcement-price">Цена: 6 000 тенге</p>
                             </div>
                            <a href="https://t.me/mxiwer" target="_blank" rel="noopener noreferrer" class="buy-button">Купить</a>
                        </div>
                        <h3 class="announcement-title">iPhone 4s 8Gb (без SIM-карты)</h3>
                        <p><strong>Состояние:</strong> Полностью рабочий, на крышке присутствуют царапины.</p>
                        <p><strong>Цвет:</strong> Черный.</p>
                        <p><strong>Комплект поставки:</strong> Провод для зарядки.</p>
                        <div class="announcement-extra-info">
                            <strong>Дополнительная информация:</strong>
                            <p>Данная модель iPhone 4s имеет 8 Гб встроенной памяти и не поддерживает использование SIM-карт (предназначен для использования без сотовой связи, например, для игр, просмотра видео или использования приложений через Wi-Fi).</p> </div>
                    </div>
                </article>

                <article class="announcement-card">
                    <img src="7.png" alt="Фото BlackBerry Q10" class="announcement-photo" loading="lazy">
                    <div class="announcement-content">
                         <div class="price-buy-block">
                            <div class="location-price">
                                <p><strong>Город:</strong> Астана.</p>
                                <p class="announcement-price">Цена: 10 000 тенге</p>
                            </div>
                            <a href="https://t.me/mxiwer" target="_blank" rel="noopener noreferrer" class="buy-button">Купить</a>
                        </div>
                        <h3 class="announcement-title">Мобильный телефон BlackBerry Q10</h3>
                        <p><strong>Состояние:</strong> Полностью рабочий. Активация устройства произведена, работоспособность функций, связанных с активацией (в условиях прекращения поддержки серверов BlackBerry), подтверждена. Операционная система: BlackBerry OS 10. Общее состояние оценивается как хорошее. Присутствуют царапины на поверхности экрана. Фиксация крышки аккумуляторного отсека характеризуется как неудовлетворительная.</p>
                        <p><strong>Цвет:</strong> Черный.</p>
                        <p><strong>Комплект поставки:</strong> Отсутствует.</p>
                    </div>
                </article>

                <article class="announcement-card">
                    <img src="8.png" alt="Фото Мини ПК Dell Alienware x51" class="announcement-photo" loading="lazy">
                    <div class="announcement-content">
                         <div class="price-buy-block">
                            <div class="location-price">
                                <p><strong>Город:</strong> Астана.</p>
                                <p class="announcement-price">Цена: 70 000 тенге</p>
                            </div>
                            <a href="https://t.me/mxiwer" target="_blank" rel="noopener noreferrer" class="buy-button">Купить</a>
                        </div>
                        <h3 class="announcement-title">Мини ПК Dell Alienware x51 (Компактный настольный персональный компьютер)</h3>
                        <p><strong>Состояние:</strong> Хорошее, имеются царапины на корпусе. Видеокарта отсутствует.</p>
                        <p><strong>Цвет:</strong> Черный.</p>
                        <p><strong>Комплект поставки:</strong> Блок питания мощностью 180 Вт.</p>
                        <div class="announcement-specs">
                            <strong>Характеристики:</strong>
                            <ul>
                                <li>Процессор: Intel Core i7-3770</li>
                                <li>Оперативная память: 16 ГБ DDR3</li>
                            </ul>
                        </div>
                         <div class="announcement-description">
                            <strong>Описание:</strong>
                            <p>Dell Alienware x51 представляет собой компактный игровой ПК, разработанный для обеспечения высокой производительности в условиях ограниченного пространства. Несмотря на свои скромные размеры, он способен справиться с требовательными задачами и играми благодаря мощным внутренним компонентам. Отличительной особенностью модели является стильный дизайн с настраиваемой подсветкой AlienFX, что придает системе индивидуальность. Компактность корпуса облегчает размещение ПК в различных условиях.</p> </div>
                    </div>
                </article>

                <article class="announcement-card">
                     <img src="9.png" alt="Фото Intel Optane SSD 16GB" class="announcement-photo" loading="lazy">
                    <div class="announcement-content">
                         <div class="price-buy-block">
                             <div class="location-price">
                                <p><strong>Город:</strong> Астана.</p>
                                <p class="announcement-price">Цена: 2 000 тенге <span class="stock-info">(В наличии 2шт)</span></p>
                             </div>
                            <a href="https://t.me/mxiwer" target="_blank" rel="noopener noreferrer" class="buy-button">Купить</a>
                        </div>
                        <h3 class="announcement-title">Твердотельный накопитель Intel Optane SSD 16GB</h3>
                        <p><strong>Состояние:</strong> Новый, полностью рабочий.</p>
                         <div class="announcement-description">
                            <strong>Описание:</strong>
                            <p>Твердотельный накопитель Intel Optane SSD объемом 16 ГБ представляет собой высокопроизводительное энергонезависимое устройство хранения данных, основанное на технологии Intel Optane. Данная технология характеризуется низкими задержками и высокой скоростью. Предназначен для кэширования с целью повышения производительности других накопителей.</p> </div>
                         <div class="announcement-note">
                             <strong>Примечание:</strong>
                             <p>Данный накопитель имеет ограниченный объем (16 ГБ) и, как правило, используется для ускорения работы других накопителей, а не в качестве основного устройства хранения операционной системы или большого объема данных.</p> </div>
                    </div>
                </article>

                 <article class="announcement-card">
                     <img src="10.png" alt="Фото контроллер движений PlayStation Move" class="announcement-photo" loading="lazy">
                     <div class="announcement-content">
                          <div class="price-buy-block">
                              <div class="location-price">
                                 <p><strong>Город:</strong> Астана.</p>
                                 <p class="announcement-price">Цена: 2 000 тенге</p>
                              </div>
                             <a href="https://t.me/mxiwer" target="_blank" rel="noopener noreferrer" class="buy-button">Купить</a>
                         </div>
                         <h3 class="announcement-title">Контроллер движений PlayStation Move</h3>
                         <p><strong>Состояние:</strong> Неизвестно, не проверен на работоспособность.</p>
                         <p><strong>Цвет:</strong> Черный.</p>
                         <p><strong>Комплектность:</strong> Контроллер движений PlayStation Move с ремешком на запястье.</p>
                         <div class="announcement-description">
                            <strong>Дополнительная информация:</strong>
                            <p>Контроллер PlayStation Move для систем PlayStation. Продается без проверки работоспособности.</p>
                        </div>
                     </div>
                 </article>

                <article class="announcement-card">
                     <img src="11.png" alt="Фото Мобильный геймпад GameSir X2 Type-C" class="announcement-photo" loading="lazy">
                     <div class="announcement-content">
                          <div class="price-buy-block">
                              <div class="location-price">
                                 <p><strong>Город:</strong> Астана.</p>
                                 <p class="announcement-price">Цена: 11 000 тенге.</p>
                              </div>
                             <a href="https://t.me/mxiwer" target="_blank" rel="noopener noreferrer" class="buy-button">Купить</a>
                         </div>
                         <h3 class="announcement-title">Мобильный геймпад GameSir X2 Type-C</h3>
                         <p><strong>Состояние:</strong> Отличное, полностью рабочий.</p>
                         <p><strong>Цвет:</strong> Белый с черными элементами.</p>
                         <p><strong>Комплектность:</strong> Геймпад, чехол для переноски.</p>
                         <div class="announcement-description">
                            <strong>Дополнительная информация:</strong>
                            <p>Универсальный геймпад для Android-смартфонов с разъемом Type-C. Обеспечивает комфортное управление в мобильных играх. Компактный и удобный для переноски.</p>
                        </div>
                     </div>
                 </article>
                <article class="announcement-card">
                     <img src="12.png" alt="Фото Беспроводные наушники Sony WF-1000XM5" class="announcement-photo" loading="lazy">
                     <div class="announcement-content">
                          <div class="price-buy-block">
                              <div class="location-price">
                                 <p><strong>Город:</strong> Астана.</p>
                                 <p class="announcement-price">Цена: 75 000 тенге.</p>
                              </div>
                             <a href="https://t.me/mxiwer" target="_blank" rel="noopener noreferrer" class="buy-button">Купить</a>
                         </div>
                         <h3 class="announcement-title">Беспроводные наушники Sony WF-1000XM5</h3>
                         <p><strong>Состояние:</strong> Хорошее, полностью рабочие, без каких-либо дефектов. Использовались бережно.</p>
                         <p><strong>Цвет:</strong> Черный.</p>
                         <p><strong>Комплектность:</strong> Наушники, зарядный кейс.</p>
                          <div class="announcement-description">
                             <strong>Дополнительная информация:</strong>
                             <p>Sony WF-1000XM5 – это флагманские беспроводные наушники, обеспечивающие превосходное качество звука благодаря передовым технологиям обработки аудио. Они обладают одним из лучших на рынке систем активного шумоподавления, эффективно устраняя внешние звуки и позволяя полностью погрузиться в музыку или подкаст. Наушники также отличаются длительным временем автономной работы и удобной посадкой, что делает их идеальным выбором для повседневного использования, поездок и занятий спортом. Интуитивное сенсорное управление позволяет легко переключать треки, регулировать громкость и отвечать на звонки.</p>
                         </div>
                     </div>
                 </article>
                </div> <button class="nav-button next-button" aria-label="Следующее объявление">&gt;</button>
        </div> </main>

    <script>
        const wrapper = document.querySelector('.announcements-wrapper');
        const prevButton = document.querySelector('.prev-button');
        const nextButton = document.querySelector('.next-button');
        // ВАЖНО: cards теперь находит ВСЕ карточки, включая новые
        const cards = document.querySelectorAll('.announcement-card');

        // Закомментировано по умолчанию, раскомментируйте для отладки
        // console.log('Найденные элементы:', { wrapper, prevButton, nextButton, cards });
        if (!wrapper || !prevButton || !nextButton) {
            console.error("ОШИБКА: Не найдены необходимые элементы слайдера.");
        }

        let currentIndex = 0; // Отслеживаем текущий индекс видимой карточки
        let isAnimating = false;
        const animationDuration = 300;
        let animationFrameId = null;
        const isAnimatingFallbackTimeoutDuration = animationDuration + 200;
        let isAnimatingTimeoutId = null;

        // --- Переменные для хранения начальных размеров ---
        // Перенесены внутрь initializeSlider, чтобы они пересчитывались при необходимости
        // let initialCardWidth = 0;
        // let initialGap = 0;

        // --- Переменные для свайпа ---
        let startX = 0;
        let startY = 0;
        let distX = 0;
        let distY = 0;
        let isDragging = false;
        let isHorizontalSwipe = false;
        const swipeThreshold = 50; // Порог срабатывания свайпа

        // --- Функция Easing (easeOutCubic для инерции) ---
        function easeOutCubic(t) {
            return 1 - Math.pow(1 - t, 3);
        }

        // --- Инициализация/Перерасчет размеров ---
        function initializeSlider() {
             console.log('Инициализация/Перерасчет слайдера...');
             // Пересчитываем cards здесь, т.к. их кол-во могло измениться
             const currentCards = document.querySelectorAll('.announcement-card');
             if (!wrapper || currentCards.length === 0) {
                 console.warn('initializeSlider: Wrapper или cards не найдены/пусты.');
                 updateButtonState(); // Обновляем кнопки на всякий случай
                 return;
             }
             const firstCard = currentCards[0];
             const wrapperStyle = window.getComputedStyle(wrapper);
             const gap = parseFloat(wrapperStyle.gap) || 0;
             const cardWidth = firstCard.offsetWidth; // Используем текущую ширину

             console.log('initializeSlider - cardWidth:', cardWidth, 'gap:', gap);
             if (cardWidth === 0) {
                 setTimeout(initializeSlider, 100); // Повторный вызов если размеры еще не применились
                 return;
             }
             // Устанавливаем начальную позицию и индекс (если это первая инициализация)
             if (currentIndex === 0 && wrapper.scrollLeft !== 0) {
                 wrapper.scrollLeft = 0; // Убедимся, что начинаем с 0
             }
             updateButtonState();
        }


        // --- Обновление состояния кнопок (по индексу) ---
        function updateButtonState() {
            // Обновляем список карточек здесь на всякий случай
            const currentCards = document.querySelectorAll('.announcement-card');
            if (!prevButton || !nextButton || !currentCards || currentCards.length === 0) {
                if (prevButton) prevButton.disabled = true;
                if (nextButton) nextButton.disabled = true;
                return;
            };
            // Небольшая задержка перед обновлением состояния
             setTimeout(() => {
                prevButton.disabled = currentIndex <= 0 || isAnimating;
                nextButton.disabled = currentIndex >= currentCards.length - 1 || isAnimating; // Используем currentCards.length
                // console.log(`updateButtonState - currentIndex: ${currentIndex}, cards: ${currentCards.length}, isAnimating: ${isAnimating}, Buttons: {prev: ${prevButton.disabled}, next: ${nextButton.disabled}}`);
            }, 10);
        }

         // --- Страховочный сброс анимации ---
         function forceResetAnimationState() {
            // console.warn("Принудительный сброс состояния анимации через таймаут.");
            isAnimating = false;
            if(animationFrameId) cancelAnimationFrame(animationFrameId);
            animationFrameId = null;
            updateButtonState();
        }

        // --- Кастомная анимация скролла ---
        function animateScroll(targetScrollLeft) {
            const startScrollLeft = wrapper.scrollLeft;
            const distance = targetScrollLeft - startScrollLeft;
            let startTime = null;
            // console.log(`animateScroll: Старт анимации от ${startScrollLeft} до ${targetScrollLeft}`);

            if (animationFrameId) { cancelAnimationFrame(animationFrameId); }
            clearTimeout(isAnimatingTimeoutId);

            function animationStep(timestamp) {
                try {
                    if (!isAnimating) {
                         // console.warn("animateScroll: Анимация прервана (isAnimating = false).");
                         if(animationFrameId) cancelAnimationFrame(animationFrameId);
                         animationFrameId = null;
                         return;
                    }
                    if (startTime === null) { startTime = timestamp; }
                    const elapsedTime = timestamp - startTime;
                    let progress = Math.min(1, elapsedTime / animationDuration);
                    let easedProgress = easeOutCubic(progress);
                    easedProgress = Math.min(1, easedProgress);

                    wrapper.scrollLeft = startScrollLeft + distance * easedProgress;

                    if (progress < 1) {
                        animationFrameId = requestAnimationFrame(animationStep);
                    } else {
                        // console.log('animateScroll: Анимация завершена успешно.');
                        wrapper.scrollLeft = targetScrollLeft; // Финальная позиция
                        isAnimating = false; // Сбрасываем флаг
                        animationFrameId = null;
                        clearTimeout(isAnimatingTimeoutId); // Очищаем страховочный таймаут
                        updateButtonState(); // Обновляем кнопки по завершении
                    }
                } catch (error) {
                     console.error("Ошибка в animationStep:", error);
                     isAnimating = false; // Сбрасываем флаг при ошибке
                     clearTimeout(isAnimatingTimeoutId);
                     updateButtonState();
                }
            }
            animationFrameId = requestAnimationFrame(animationStep); // Запускаем
            isAnimatingTimeoutId = setTimeout(forceResetAnimationState, isAnimatingFallbackTimeoutDuration);
        }
        // --- Конец функции анимации ---


        // --- Функция для скролла к КАРТОЧКЕ ПО ИНДЕКСУ (использует ОТНОСИТЕЛЬНЫЙ offsetLeft) ---
        function scrollToCard(newIndex) {
            // Обновляем список карточек перед использованием
            const currentCards = document.querySelectorAll('.announcement-card');

            if (isAnimating || !wrapper || !currentCards || currentCards.length === 0 || newIndex < 0 || newIndex >= currentCards.length) {
                 // console.log(`scrollToCard: Блокировано или неверный индекс. isAnimating=${isAnimating}, newIndex=${newIndex}, cardsCount=${currentCards.length}`);
                return;
            }

            const targetCard = currentCards[newIndex];
            const firstCard = currentCards[0]; // Точка отсчета

             if (!targetCard || !firstCard) {
                 console.error("scrollToCard: Не удалось найти firstCard или targetCard.");
                 return;
             }

            // *** РАСЧЕТ целевой позиции через ОТНОСИТЕЛЬНЫЙ offsetLeft ***
            const targetScrollLeft = targetCard.offsetLeft - firstCard.offsetLeft;
            // *** КОНЕЦ РАСЧЕТА ***

            if (Math.abs(wrapper.scrollLeft - targetScrollLeft) < 2) {
                 // console.log(`scrollToCard: Уже на индексе ${newIndex}`);
                 if(currentIndex !== newIndex) {
                    currentIndex = newIndex;
                    updateButtonState();
                 }
                 if (isAnimating) { // Сброс флага, если застряли
                     isAnimating = false;
                     clearTimeout(isAnimatingTimeoutId);
                     if(animationFrameId) cancelAnimationFrame(animationFrameId);
                     animationFrameId = null;
                     updateButtonState();
                 }
                 return;
            }

            // console.log(`scrollToCard: Скролл к индексу ${newIndex}, ОТНОСИТЕЛЬНЫЙ targetScrollLeft: ${targetScrollLeft}`);
            isAnimating = true;
            currentIndex = newIndex;
            updateButtonState();
            animateScroll(targetScrollLeft);
        }


        // --- Обработчики событий ---
        if (prevButton) { prevButton.addEventListener('click', () => scrollToCard(currentIndex - 1)); }
        if (nextButton) { nextButton.addEventListener('click', () => scrollToCard(currentIndex + 1)); }

        if (wrapper) {
            wrapper.addEventListener('touchstart', (e) => {
                if (isAnimating) return;
                startX = e.touches[0].pageX; startY = e.touches[0].pageY;
                distX = 0; distY = 0;
                isDragging = true; isHorizontalSwipe = false;
                // console.log('touchstart в точке X:', startX);
            }, { passive: true });

            wrapper.addEventListener('touchmove', (e) => {
                if (!isDragging || isAnimating) return;
                if (e.touches.length === 0) return;

                const currentX = e.touches[0].pageX;
                const currentY = e.touches[0].pageY;
                const currentDistX = currentX - startX;
                const currentDistY = currentY - startY;

                if (isDragging && !isHorizontalSwipe && (Math.abs(currentDistX) > 5 || Math.abs(currentDistY) > 5)) {
                     if (Math.abs(currentDistX) > Math.abs(currentDistY)) {
                          isHorizontalSwipe = true;
                          // console.log('touchmove: Определено горизонтальное движение.');
                     } else {
                          isDragging = false;
                          // console.log('touchmove: Определено вертикальное движение, свайп отменен.');
                     }
                }

                if (isHorizontalSwipe) {
                     distX = currentDistX;
                     // console.log('touchmove - Горизонтальное смещение distX:', distX);
                     e.preventDefault();
                }

            }, { passive: false });

            wrapper.addEventListener('touchend', (e) => {
                // console.log(`touchend - isDragging: ${isDragging}, isAnimating: ${isAnimating}, isHorizontalSwipe: ${isHorizontalSwipe}, distX: ${distX}`);
                if (!isDragging) return;

                const wasHorizontal = isHorizontalSwipe;
                isDragging = false; isHorizontalSwipe = false;

                if (isAnimating) { /* console.log('touchend: Блокировано, идет анимация.'); */ return; }

                if (wasHorizontal && Math.abs(distX) >= swipeThreshold) {
                    // console.log(`touchend: Свайп подтвержден, дистанция ${distX}`);
                    const direction = distX < 0 ? 1 : -1;
                    scrollToCard(currentIndex + direction);
                } else {
                    // console.log(`touchend: Движение проигнорировано | dist |: ${Math.abs(distX)}`);
                }
            });

            wrapper.addEventListener('touchcancel', () => {
                 // console.log('touchcancel');
                 isDragging = false; isHorizontalSwipe = false;
            });
        }

        // --- Инициализация ---
        // Убрали расчет размеров, только обновление кнопок
        window.addEventListener('load', () => {
            console.log('Событие: window loaded');
            // Установим начальное состояние
            wrapper.scrollLeft = 0;
            currentIndex = 0;
            setTimeout(updateButtonState, 150); // Обновляем кнопки с задержкой
        });
        // Обновляем только состояние кнопок при ресайзе
        window.addEventListener('resize', updateButtonState);

        // Можно убрать, т.к. вызывается на load
        // setTimeout(updateButtonState, 250);

    </script>

</body>
</html>

