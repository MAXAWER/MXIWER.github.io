<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MThread - Лента объявлений</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <header class="site-header">
        <div class="button-container">
            <a href="https://t.me/Sureddorippaa" target="_blank" class="button">MThread Маркет</a>
            <a href="https://t.me/SureddorippaaChat" target="_blank" class="button">MThread Чат</a>
            <a href="https://t.me/SureddorippaaReviews" target="_blank" class="button">MThread Отзывы</a>
        </div>
    </header>

    <main class="feed-container">
        <h2 class="feed-title">Лента объявлений</h2>

        <div class="horizontal-feed">
            <button class="nav-button prev-button" aria-label="Предыдущее объявление">&lt;</button>

            <div class="announcements-wrapper">

                <article class="announcement-card">
                    <img src="1.png" alt="Фото Контроллер Nintendo Switch" class="announcement-photo" loading="lazy">
                    <div class="announcement-content">
                        <div class="price-buy-block">
                            <div class="location-price">
                                <p><strong>Город:</strong> Астана.</p>
                                <p class="announcement-price">Цена: 10 000 тенге</p>
                            </div>
                            <a href="https://t.me/mxiwer" target="_blank" rel="noopener noreferrer" class="buy-button">Купить</a>
                        </div>
                        <h3 class="announcement-title">Контроллер для игровой консоли Nintendo Switch</h3>
                        <p><strong>Состояние:</strong> Полностью исправен, функциональных дефектов не имеет. Подтверждена работоспособность всех кнопок и функций.</p>
                        <p><strong>Цвет:</strong> Черный.</p>
                        <p><strong>Комплект поставки:</strong> Только контроллер (без оригинальной упаковки, кабелей и дополнительных аксессуаров).</p>
                    </div>
                </article>

                 <article class="announcement-card">
                     <img src="3.png" alt="Фото Салазки для HDD Nzxt H710I" class="announcement-photo" loading="lazy">
                    <div class="announcement-content">
                        <div class="price-buy-block">
                            <div class="location-price">
                                <p><strong>Город:</strong> Астана.</p>
                                <p class="announcement-price">Цена: 5 000 тенге</p>
                            </div>
                            <a href="https://t.me/mxiwer" target="_blank" rel="noopener noreferrer" class="buy-button">Купить</a>
                        </div>
                        <h3 class="announcement-title">Салазки для HDD из корпуса Nzxt H710I</h3>
                        <p><strong>Состояние:</strong> Хорошее.</p>
                        <p><strong>Цвет:</strong> Черный.</p>
                        <p><strong>Комплект поставки:</strong> Без комплекта (только салазки).</p>
                    </div>
                </article>

                <article class="announcement-card">
                     <img src="4.png" alt="Фото Ноутбук Dell Alienware 17 R2" class="announcement-photo" loading="lazy">
                    <div class="announcement-content">
                         <div class="price-buy-block">
                             <div class="location-price">
                                <p><strong>Город:</strong> Астана.</p>
                                <p class="announcement-price">Цена: 120 000 тенге</p>
                             </div>
                            <a href="https://t.me/mxiwer" target="_blank" rel="noopener noreferrer" class="buy-button">Купить</a>
                        </div>
                        <h3 class="announcement-title">Ноутбук Dell Alienware 17 R2</h3>
                        <p><strong>Состояние:</strong> Полностью рабочий, установлен новый аккумулятор, несколько царапин на крышке (визуальный недостаток, не влияющий на основную функциональность).</p>
                        <p><strong>Цвет:</strong> Черно-серый.</p>
                        <p><strong>Комплект поставки:</strong> Зарядное устройство и коробка.</p>
                        <div class="announcement-specs">
                            <strong>Характеристики:</strong>
                            <ul>
                                <li>Процессор: Intel Core i7-4710HQ</li>
                                <li>Оперативная память: 16 ГБ DDR3</li>
                                <li>Видеокарта: NVIDIA GeForce GTX 980</li>
                                <li>Накопитель: SSD M.2 128 ГБ</li>
                            </ul>
                        </div>
                    </div>
                </article>

                <article class="announcement-card">
                    <img src="5.png" alt="Фото Alienware Graphics Amplifier (eGPU)" class="announcement-photo" loading="lazy">
                    <div class="announcement-content">
                         <div class="price-buy-block">
                             <div class="location-price">
                                <p><strong>Город:</strong> Астана.</p>
                                <p class="announcement-price">Цена: 50 000 тенге</p>
                             </div>
                            <a href="https://t.me/mxiwer" target="_blank" rel="noopener noreferrer" class="buy-button">Купить</a>
                        </div>
                        <h3 class="announcement-title">Alienware Graphics Amplifier (eGPU)</h3>
                        <p><strong>Состояние:</strong> В хорошем состоянии, полностью рабочий.</p>
                        <p><strong>Цвет:</strong> Черный.</p>
                        <p><strong>Комплект поставки:</strong> Кабель соединения с ПК, кабель питания.</p>
                        <div class="announcement-description">
                            <strong>Описание:</strong>
                            <p>Alienware Graphics Amplifier представляет собой внешнюю док-станцию для видеокарты, разработанную специально для ноутбуков Alienware. Это устройство позволяет значительно повысить графическую производительность ноутбука, подключая к нему настольную видеокарту. Amplifier оснащен собственным блоком питания, обеспечивающим необходимую мощность для работы высокопроизводительных видеокарт. Подключение к ноутбуку осуществляется через проприетарный разъем PCI-Express, обеспечивающий высокую пропускную способность для передачи данных между видеокартой и системой ноутбука. Использование Graphics Amplifier позволяет запускать на ноутбуке самые требовательные игры и приложения, требующие мощной графики, при этом сохраняя мобильность самого ноутбука при необходимости.</p> </div>
                    </div>
                </article>

                <article class="announcement-card">
                    <img src="6.png" alt="Фото iPhone 4s 8Gb" class="announcement-photo" loading="lazy">
                    <div class="announcement-content">
                         <div class="price-buy-block">
                             <div class="location-price">
                                <p><strong>Город:</strong> Астана.</p>
                                <p class="announcement-price">Цена: 6 000 тенге</p>
                             </div>
                            <a href="https://t.me/mxiwer" target="_blank" rel="noopener noreferrer" class="buy-button">Купить</a>
                        </div>
                        <h3 class="announcement-title">iPhone 4s 8Gb (без SIM-карты)</h3>
                        <p><strong>Состояние:</strong> Полностью рабочий, на крышке присутствуют царапины.</p>
                        <p><strong>Цвет:</strong> Черный.</p>
                        <p><strong>Комплект поставки:</strong> Провод для зарядки.</p>
                        <div class="announcement-extra-info">
                            <strong>Дополнительная информация:</strong>
                            <p>Данная модель iPhone 4s имеет 8 Гб встроенной памяти и не поддерживает использование SIM-карт (предназначен для использования без сотовой связи, например, для игр, просмотра видео или использования приложений через Wi-Fi).</p> </div>
                    </div>
                </article>

                <article class="announcement-card">
                    <img src="7.png" alt="Фото BlackBerry Q10" class="announcement-photo" loading="lazy">
                    <div class="announcement-content">
                         <div class="price-buy-block">
                            <div class="location-price">
                                <p><strong>Город:</strong> Астана.</p>
                                <p class="announcement-price">Цена: 10 000 тенге</p>
                            </div>
                            <a href="https://t.me/mxiwer" target="_blank" rel="noopener noreferrer" class="buy-button">Купить</a>
                        </div>
                        <h3 class="announcement-title">Мобильный телефон BlackBerry Q10</h3>
                        <p><strong>Состояние:</strong> Полностью рабочий. Активация устройства произведена, работоспособность функций, связанных с активацией (в условиях прекращения поддержки серверов BlackBerry), подтверждена. Операционная система: BlackBerry OS 10. Общее состояние оценивается как хорошее. Присутствуют царапины на поверхности экрана. Фиксация крышки аккумуляторного отсека характеризуется как неудовлетворительная.</p>
                        <p><strong>Цвет:</strong> Черный.</p>
                        <p><strong>Комплект поставки:</strong> Отсутствует.</p>
                    </div>
                </article>

                <article class="announcement-card">
                    <img src="8.png" alt="Фото Мини ПК Dell Alienware x51" class="announcement-photo" loading="lazy">
                    <div class="announcement-content">
                         <div class="price-buy-block">
                            <div class="location-price">
                                <p><strong>Город:</strong> Астана.</p>
                                <p class="announcement-price">Цена: 70 000 тенге</p>
                            </div>
                            <a href="https://t.me/mxiwer" target="_blank" rel="noopener noreferrer" class="buy-button">Купить</a>
                        </div>
                        <h3 class="announcement-title">Мини ПК Dell Alienware x51 (Компактный настольный персональный компьютер)</h3>
                        <p><strong>Состояние:</strong> Хорошее, имеются царапины на корпусе. Видеокарта отсутствует.</p>
                        <p><strong>Цвет:</strong> Черный.</p>
                        <p><strong>Комплект поставки:</strong> Блок питания мощностью 180 Вт.</p>
                        <div class="announcement-specs">
                            <strong>Характеристики:</strong>
                            <ul>
                                <li>Процессор: Intel Core i7-3770</li>
                                <li>Оперативная память: 16 ГБ DDR3</li>
                            </ul>
                        </div>
                         <div class="announcement-description">
                            <strong>Описание:</strong>
                            <p>Dell Alienware x51 представляет собой компактный игровой ПК, разработанный для обеспечения высокой производительности в условиях ограниченного пространства. Несмотря на свои скромные размеры, он способен справиться с требовательными задачами и играми благодаря мощным внутренним компонентам. Отличительной особенностью модели является стильный дизайн с настраиваемой подсветкой AlienFX, что придает системе индивидуальность. Компактность корпуса облегчает размещение ПК в различных условиях.</p> </div>
                    </div>
                </article>

                <article class="announcement-card">
                     <img src="9.png" alt="Фото Intel Optane SSD 16GB" class="announcement-photo" loading="lazy">
                    <div class="announcement-content">
                         <div class="price-buy-block">
                             <div class="location-price">
                                <p><strong>Город:</strong> Астана.</p>
                                <p class="announcement-price">Цена: 2 000 тенге <span class="stock-info">(В наличии 2шт)</span></p>
                             </div>
                            <a href="https://t.me/mxiwer" target="_blank" rel="noopener noreferrer" class="buy-button">Купить</a>
                        </div>
                        <h3 class="announcement-title">Твердотельный накопитель Intel Optane SSD 16GB</h3>
                        <p><strong>Состояние:</strong> Новый, полностью рабочий.</p>
                         <div class="announcement-description">
                            <strong>Описание:</strong>
                            <p>Твердотельный накопитель Intel Optane SSD объемом 16 ГБ представляет собой высокопроизводительное энергонезависимое устройство хранения данных, основанное на технологии Intel Optane. Данная технология характеризуется низкими задержками и высокой скоростью. Предназначен для кэширования с целью повышения производительности других накопителей.</p> </div>
                         <div class="announcement-note">
                             <strong>Примечание:</strong>
                             <p>Данный накопитель имеет ограниченный объем (16 ГБ) и, как правило, используется для ускорения работы других накопителей, а не в качестве основного устройства хранения операционной системы или большого объема данных.</p> </div>
                    </div>
                </article>

            </div> <button class="nav-button next-button" aria-label="Следующее объявление">&gt;</button>
        </div> </main>

    <script>
        const wrapper = document.querySelector('.announcements-wrapper');
        const prevButton = document.querySelector('.prev-button');
        const nextButton = document.querySelector('.next-button');
        const cards = document.querySelectorAll('.announcement-card');

        if (!wrapper || !prevButton || !nextButton) {
            console.error("ОШИБКА: Не найдены необходимые элементы слайдера.");
        }

        let currentIndex = 0; // Отслеживаем текущий индекс видимой карточки
        let isAnimating = false;
        const animationDuration = 300;
        let animationFrameId = null;
        const isAnimatingFallbackTimeoutDuration = animationDuration + 200;
        let isAnimatingTimeoutId = null;

        // --- Переменные для свайпа ---
        let startX = 0;
        let startY = 0;
        let distX = 0;
        let distY = 0;
        let isDragging = false;
        let isHorizontalSwipe = false;
        const swipeThreshold = 50; // Порог срабатывания свайпа

        // --- Функция Easing (easeOutCubic для инерции) ---
        function easeOutCubic(t) {
            return 1 - Math.pow(1 - t, 3);
        }

        // --- Обновление состояния кнопок (по индексу) ---
        function updateButtonState() {
            if (!prevButton || !nextButton || cards.length === 0) return;
            // Небольшая задержка может помочь, если кнопки обновляются до того, как isAnimating сбросится
             setTimeout(() => {
                prevButton.disabled = currentIndex <= 0 || isAnimating;
                nextButton.disabled = currentIndex >= cards.length - 1 || isAnimating;
                // console.log(`updateButtonState - currentIndex: ${currentIndex}, isAnimating: ${isAnimating}, Buttons: {prev: ${prevButton.disabled}, next: ${nextButton.disabled}}`);
             }, 10); // Короткая задержка
        }

         // --- Страховочный сброс анимации ---
         function forceResetAnimationState() {
            // console.warn("Принудительный сброс состояния анимации через таймаут.");
            isAnimating = false;
            if(animationFrameId) cancelAnimationFrame(animationFrameId);
            animationFrameId = null;
            updateButtonState(); // Обновляем кнопки после принудительного сброса
        }

        // --- Кастомная анимация скролла (без изменений) ---
        function animateScroll(targetScrollLeft) {
            const startScrollLeft = wrapper.scrollLeft;
            const distance = targetScrollLeft - startScrollLeft;
            let startTime = null;
            // console.log(`animateScroll: Старт анимации от ${startScrollLeft} до ${targetScrollLeft}`);

            if (animationFrameId) { cancelAnimationFrame(animationFrameId); }
            clearTimeout(isAnimatingTimeoutId);

            function animationStep(timestamp) {
                try {
                    if (!isAnimating) {
                         // console.warn("animateScroll: Анимация прервана (isAnimating = false).");
                         if(animationFrameId) cancelAnimationFrame(animationFrameId);
                         animationFrameId = null;
                         return;
                    }
                    if (startTime === null) { startTime = timestamp; }
                    const elapsedTime = timestamp - startTime;
                    let progress = Math.min(1, elapsedTime / animationDuration);
                    let easedProgress = easeOutCubic(progress);
                    easedProgress = Math.min(1, easedProgress);

                    wrapper.scrollLeft = startScrollLeft + distance * easedProgress;

                    if (progress < 1) {
                        animationFrameId = requestAnimationFrame(animationStep); // Продолжаем
                    } else {
                        // console.log('animateScroll: Анимация завершена успешно.');
                        wrapper.scrollLeft = targetScrollLeft; // Финальная позиция
                        isAnimating = false; // Сбрасываем флаг
                        animationFrameId = null;
                        clearTimeout(isAnimatingTimeoutId); // Очищаем страховочный таймаут
                        updateButtonState(); // Обновляем кнопки по завершении
                    }
                } catch (error) {
                     console.error("Ошибка в animationStep:", error);
                     isAnimating = false; // Сбрасываем флаг при ошибке
                     clearTimeout(isAnimatingTimeoutId);
                     updateButtonState();
                }
            }
            animationFrameId = requestAnimationFrame(animationStep); // Запускаем
            isAnimatingTimeoutId = setTimeout(forceResetAnimationState, isAnimatingFallbackTimeoutDuration);
        }
        // --- Конец функции анимации ---


        // --- ИЗМЕНЕНА Функция для скролла к КАРТОЧКЕ ПО ИНДЕКСУ (использует ОТНОСИТЕЛЬНЫЙ offsetLeft) ---
        function scrollToCard(newIndex) {
            // Проверяем границы и флаг анимации
            if (isAnimating || !wrapper || !cards || newIndex < 0 || newIndex >= cards.length) {
                 // console.log(`scrollToCard: Блокировано или неверный индекс. isAnimating=${isAnimating}, newIndex=${newIndex}`);
                return;
            }

            const targetCard = cards[newIndex];
            const firstCard = cards[0]; // Нужна для точки отсчета

            // *** НОВЫЙ РАСЧЕТ целевой позиции ***
            // Рассчитываем целевое смещение как разницу между offsetLeft нужной карточки
            // и offsetLeft самой первой карточки. Это должно дать точное значение scrollLeft.
            const targetScrollLeft = targetCard.offsetLeft - firstCard.offsetLeft;
            // *** КОНЕЦ НОВОГО РАСЧЕТА ***

            // Проверяем, нужно ли вообще скроллить (сравниваем с погрешностью)
            if (Math.abs(wrapper.scrollLeft - targetScrollLeft) < 2) { // Увеличил погрешность до 2px
                 // console.log(`scrollToCard: Уже на индексе ${newIndex} (scrollLeft ${wrapper.scrollLeft} ~= target ${targetScrollLeft})`);
                 if(currentIndex !== newIndex) { // Синхронизируем индекс, если он разошелся
                    currentIndex = newIndex;
                    updateButtonState();
                 }
                 // Важно: сбрасываем флаг анимации, если она была прервана и мы уже на месте
                 if (isAnimating) {
                     isAnimating = false;
                     clearTimeout(isAnimatingTimeoutId);
                     if(animationFrameId) cancelAnimationFrame(animationFrameId);
                     animationFrameId = null;
                     updateButtonState();
                 }
                 return;
            }

            // console.log(`scrollToCard: Скролл к индексу ${newIndex}, ОТНОСИТЕЛЬНЫЙ targetScrollLeft: ${targetScrollLeft}`);
            isAnimating = true;
            currentIndex = newIndex; // Обновляем текущий индекс
            updateButtonState(); // Обновляем кнопки (отключаем)
            animateScroll(targetScrollLeft); // Запускаем анимацию к точному смещению
        }


        // --- Обработчики событий (вызывают scrollToCard) ---
        if (prevButton) {
            prevButton.addEventListener('click', () => {
                // console.log('Клик: Кнопка Назад');
                scrollToCard(currentIndex - 1); // Переход к предыдущему индексу
            });
        }
        if (nextButton) {
            nextButton.addEventListener('click', () => {
                // console.log('Клик: Кнопка Вперед');
                scrollToCard(currentIndex + 1); // Переход к следующему индексу
            });
        }

        if (wrapper) {
            wrapper.addEventListener('touchstart', (e) => {
                if (isAnimating) return;
                startX = e.touches[0].pageX; startY = e.touches[0].pageY;
                distX = 0; distY = 0;
                isDragging = true; isHorizontalSwipe = false;
                // console.log('touchstart в точке X:', startX);
            }, { passive: true });

            wrapper.addEventListener('touchmove', (e) => {
                if (!isDragging || isAnimating) return;
                if (e.touches.length === 0) return;

                const currentX = e.touches[0].pageX;
                const currentY = e.touches[0].pageY;
                const currentDistX = currentX - startX;
                const currentDistY = currentY - startY;

                if (!isHorizontalSwipe && (Math.abs(currentDistX) > 5 || Math.abs(currentDistY) > 5)) {
                     if (Math.abs(currentDistX) > Math.abs(currentDistY)) {
                          isHorizontalSwipe = true;
                          // console.log('touchmove: Определено горизонтальное движение.');
                     } else {
                          isDragging = false;
                          // console.log('touchmove: Определено вертикальное движение, свайп отменен.');
                     }
                }

                if (isHorizontalSwipe) {
                     distX = currentDistX;
                     // console.log('touchmove - Горизонтальное смещение distX:', distX);
                     e.preventDefault(); // Предотвращаем скролл страницы
                }

            }, { passive: false });

            wrapper.addEventListener('touchend', (e) => {
                // console.log(`touchend - isDragging: ${isDragging}, isAnimating: ${isAnimating}, isHorizontalSwipe: ${isHorizontalSwipe}, distX: ${distX}`);
                if (!isDragging) return;

                const wasHorizontal = isHorizontalSwipe;
                isDragging = false; isHorizontalSwipe = false;

                if (isAnimating) { /* console.log('touchend: Блокировано, идет анимация.'); */ return; }

                if (wasHorizontal && Math.abs(distX) >= swipeThreshold) {
                    // console.log(`touchend: Свайп подтвержден, дистанция ${distX}`);
                    const direction = distX < 0 ? 1 : -1; // 1 = next, -1 = prev
                    scrollToCard(currentIndex + direction);
                } else {
                    // console.log(`touchend: Движение проигнорировано | dist |: ${Math.abs(distX)}`);
                }
            });

            wrapper.addEventListener('touchcancel', () => {
                 // console.log('touchcancel');
                 isDragging = false; isHorizontalSwipe = false;
            });
        }

        // --- Инициализация ---
        function initializeSlider() {
             console.log('Инициализация слайдера...');
             if (!wrapper || cards.length === 0) return;
             // Устанавливаем начальную позицию на 0 без анимации
             wrapper.scrollLeft = 0;
             currentIndex = 0;
             // Обновляем кнопки на основе начального индекса 0
             updateButtonState();
        }

        window.addEventListener('load', () => {
            console.log('Событие: window loaded');
            setTimeout(initializeSlider, 150); // Немного увеличил задержку для гарантии отрисовки
        });
        // Обновляем кнопки при ресайзе (расчет размеров больше не нужен для логики скролла)
        window.addEventListener('resize', updateButtonState);

    </script>

</body>
</html>

